---
tags:
  - computerscience
aliases:
  - 局域网
  - LAN
chapter: Ch3 数据链路层
subject: "[[计算机网络]]"
category: "[[📖Notes]]"
---

## 概念

常见的局域网拓扑结构有：星形结构、环形结构、总线型结构、星形和总线型结合的复合型结构。

局域网可以使用**铜缆、双绞线和光纤**等多种传输介质，其中**双绞线**为主流传输介质。

三种局域网的拓扑实现：

- 以太网。逻辑拓扑是总线型结构，物理拓扑是星形结构
- 令牌环。逻辑拓扑是环形结构，物理拓扑是星型结构
- FDDI（光纤分布数字接口）。逻辑拓扑是环形结构，物理拓扑是双环结构

IEEE 802 标准将数据链路层拆分为两个子层：

- 逻辑链路控制（LLC）。向网络层提供无确认无连接、面向连接、带确认无连接、高速传送四种不同的连接服务类型
- 介质访问控制（MAC）。主要实现组帧和拆卸帧、比特传输差错检测、透明传输

## 以太网和 IEEE 802.3

以太网逻辑上采用总线型拓扑结构，所有计算机共享同一条总线，信息以广播方式发送，以太网使用 CSMA/CD 对总线进行访问控制。

### 以太网 MAC 协议提供的服务类型

- 采用无连接的工作方式，既不对发送的数据帧编号又不要求接收方发送确认，即以太网尽最大努力交付数据，提供的是**不可靠服务**
- 发送的数据都是用**曼彻斯特编码**的信号

![[传输介质#各种传输介质对比]]

### 以太网的 MAC 地址

IEEE 802 为局域网规定了一种 48 位的全球地址，是指局域网上的每台计算机中固化在适配器的 [[只读存储器 ROM|ROM]] 中的地址，称为物理地址或 MAC 地址。

**一个适配器对应一个固定的 MAC 地址**

适配器从网络上每收到一个 MAC 帧，首先都要用硬件检查 MAC 帧中的目的地址。若是发往本站的帧，则收下，否则丢弃。帧的类型有三种：

1. 单播帧：目的地址与本站地址相同
2. 广播帧：全 1 地址
3. [[IP 多播#在局域网上进行硬件多播|多播帧]]：发送给局域网上一部分站点的帧

### 以太网的 MAC 帧

![](https://img.mileomni.com/1731243069981.png)

| 字段   | 功能                                                                  |
| ---- | ------------------------------------------------------------------- |
| 目的地址 | 6 B，目的适配器的 MAC 地址                                                   |
| 源地址  | 6 B，源适配器的 MAC 地址                                                    |
| 类型   | 2 B，指出数据应该交给那个上层协议处理，如 IP 协议                                        |
| 数据   | 46 B~1500 B，承载上层的协议数据单元，若数据小于 46 B，MAC 就在数据字段的后面加上填充字段，确保帧长不小于 64 B |
| FCS  | 校验码，不校验前导码                                                          |

### 高速以太网

| 标准名称     | 100 BASE-T 以太网      | 吉比特以太网              | 10 吉比特以太网 |
| -------- | ------------------- | ------------------- | --------- |
| 传输速率     | 100 Mb/s            | 1 Gb/s              | 10 Gb/s   |
| 传输介质     | 双绞线                 | 双绞线或光纤              | 双绞线或光纤    |
| 通信方式     | 支持半双工和全双工           | 支持半双工和全双工           | 只有全双工方式   |
| 介质访问控制协议 | 半双工方式下使用 CSMA/CS 协议 | 半双工方式下使用 CSMA/CS 协议 | 无         |

****
> [!tip]
> 为了让千兆以太网的网段最大长度保持 100m，最小帧长仍为 64B（与 10BASE-T 和 100BASE-T 兼容），需要使用**载波延伸**的和**分组突发**的方法。
>
> **载波延伸**：将**争用期增大为 512B 的发送时间**，保持最小帧长为 64B，长度不足 512B 的部分使用特殊字符填充。
>
> **分组突发**：防止载波延伸机制下，填充字符开销太大，可以使用分组突发。**当有很多短帧发送时，只需第一个短帧使用载波延伸填充，后续可以一个接一个传送**，只需要在帧之前空开必要的帧间最小间隔即可。

## IEEE 802.11 无线局域网

AP (Access Point)：接入点。

使用 802.11 系列协议的局域网又称 Wi-Fi。

在IEEE 802.11无线局域网协议中，MAC帧主要包括以下三类：

1. 数据帧：用来在站点间传输数据
2. 管理帧：通常与数据帧搭配使用，负责区域的清空、虚拟载波监听的维护以及信道的接入，并于收到数据帧时给与确认。如：**ACK 帧、RTS 帧、CTS 帧等。**
3. 控制帧：主要用于加入或退出无线网络，以及处理 AP 之间连接的转移事宜。**信标帧、关联请求帧以及身份认证帧等都属于管理帧。**

### 802.11 局域网的 MAC 帧

![](https://img.mileomni.com/1731243070054.png)

802.11 帧的 MAC 首部中最重要的是 4 个 MAC地址字段。这里仅讨论前三个地址（第四个用于自组网络）

| 去往 AP | 来自 AP | 地址 1       | 地址 2       | 地址 3 | 地址 4 |
| ----- | ----- | ---------- | ---------- | ---- | ---- |
| 0     | 1     | 接收地址=目的地址  | 发送地址=AP 地址 | 源地址  | --   |
| 1     | 0     | 接收地址=AP 地址 | 发送地址=源地址   | 目的地址 | --   |
| 1     | 1     | 接收地址=AP 地址 | 发送地址=AP 地址 | 目的地址 | 源地址  |

当主机发往 AP 时，去往 AP=1，所以直接的接收地址就是 AP 地址，发送地址=源地址，而目的地址就存放在地址 3 中。
当 AP 发往主机时，来自 AP=1，所以发送地址就是 AP 地址，接收地址就是目的地址，而源地址被 AP 地址掩盖了所以放在地址 3 中。

## VLAN

一个以太网是一个广播域，当一个以太网中包含的计算机太多时，往往会导致：

- 以太网中出现大量广播帧，特别是经常使用的 [[地址解析协议 ARP|ARP]] 和 [[动态主机配置协议 DHCP|DHCP]] 协议
- 一个单位的不同部门共享一个局域网，对信息保密和安全不利

通过虚拟局域网 VLAN，可将一个较大的局域网分割成一些较小的与地理位置无关的逻辑上的 VLAN。

有以下三种划分 VLAN 的方式：

1. 基于接口
2. 基于 MAC 地址
3. 基于 IP 地址

**因为VLAN 帧的首部多了一个 VLAN 标记，所以以太网的最大帧长变成了 1522 字节。**

如果两个同 VLAN 的站之间传送帧，可以直接传送，如果需要跨 VLAN 传送帧则需要**插入** 4 字节的 VLAN 标记，在目的站的所属的[[交换机]]处**移除**这个 VLAN 标记，最终目的站收到的是一个普通的 MAC 帧。

![](https://img.mileomni.com/1731243070166.png)
