FTP 是因特网上使用得最广泛的**文件传输协议**。FTP 提供交互式的访问，允许客户指明文件的类型与格式，并允许文件具有存取权限。

FTP 基于 [[TCP]]，使用 21 端口

FTP 使用了分离的控制连接，所以也称 FTP 的控制信息是**带外**传送的。

FTP 要修改网络文件时，要先将文件传送到本地，修改完再上传回服务器。

>网络文件系统 NFS 采用另一种思路，进程可以远程打开一个文件，再该文件的某个特定位置读写数据。NFS 只需要复制读写位置周围的片段，不需要复制整个大文件。

## FTP 的功能

1. 提供不同种类主机系统（硬、软件体系都可以不同）之间的文件传输能力
2. 以用户权限管理的方式提供用户对远程 FTP 服务器上的文件管理能力
3. 以匿名 FTP 的方式提供公用文件共享的能力

## 控制连接与数据连接

FTP 在工作时使用两个并行的 [[TCP]] 连接：控制连接（端口 21）和数据连接（端口 20） 。

### 控制连接

服务器监听 21 端口，等待客户连接，建立在这个端口上的连接称为控制连接，用来传输控制信息（连接请求、传送请求等）。**控制连接在整个会话期间一直保持打开状态。**

### 数据连接

服务器端的控制进程在接收到 FTP 客户发送来的文件传输请求之后，就创建“数据传送进程”和“数据连接”。

“数据连接”用来连接客户端和服务器端的“数据传送进程”；
“数据传送进程”实际完成文件的传送，在传送完毕后关闭“数据传送连接”并结束运行。

数据连接有两种模式：主动模式 PORT 和被动模式 PASV。

#### 主动模式 PORT

客户端连接到服务器的 21 端口，登录成功后要读取数据时，客户端随机开放一个端口，并发送命令告知服务器，服务器收到 PORT 命令和端口号后，通过 20 端口和客户端开放的端口连接，发送数据。

>主动是指服务器主动连接客户端的端口。

#### 被动模式 PASV

客户端要读取数据时，发送 PASV 命令到服务器，服务器在本地随机开放一个端口，并告知客户端，客户端再连接到服务器的开放端口进行数据传输。

>被动模式是客户端连接到服务器的端口，“被动”是对于服务器来说的。
