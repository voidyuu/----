---
tags:
  - computerscience
chapter: Ch2 è¿›ç¨‹ä¸çº¿ç¨‹
subject: "[[æ“ä½œç³»ç»Ÿ]]"
category: "[[ğŸ“–Notes]]"
aliases:
---

## ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜

è¿›ç¨‹é—´å…³ç³»ä¸ºâ€œç”Ÿäº§èµ„æº-æ¶ˆè´¹èµ„æºâ€

```cpp
semaphore mutex = 1;
semaphore full = 0;
semaphore empty = n;

producer(){
 while(1){
  produce an item;//ç”Ÿäº§æ•°æ®
  P(empty);
  P(mutex);
  add to buffer;//å°†æ•°æ®æ”¾å…¥ç¼“å†²åŒº
  V(mutex);
  V(full);
 }
}

consumer(){
 while(1){
  P(full);
  P(mutex);
  remove an item from buffer;//ä»ç¼“å†²åŒºå–å‡ºæ•°æ®
  V(mutex);
  V(empty);
  consume the item;//æ¶ˆè´¹æ•°æ®
 }
}
```

## ç†å‘å¸ˆé—®é¢˜

è¿›ç¨‹é—´å…³ç³»ä¸ºâ€œæœåŠ¡-è¢«æœåŠ¡â€

æœ€åŸºç¡€çš„æ¨¡æ¿ï¼šæ— ç­‰å¾…ä¸Šé™ï¼ŒæœåŠ¡äººå‘˜å¯ä¼‘æ¯

```cpp
semaphore server = 0;
semaphore customer = 0;
semaphore mutex = 1;

server(){
 while(1){
  P(customer);
  P(mutex);
  å«å·;
  V(mutex);
  V(server);
  æä¾›æœåŠ¡;
 }
}

customer(){
 while(1){
  P(mutex);
  å–å·;
  V(mutex);
  V(customer);
  P(server);
  è¢«æœåŠ¡;
 }
}
```

## è¯»è€…å†™è€…é—®é¢˜

åŒç±»è¿›ç¨‹ä¸äº’æ–¥ã€å¼‚ç±»è¿›ç¨‹äº’æ–¥

```cpp
int count = 0;
semophore mutex = 1;//æ›´æ–°countæ—¶äº’æ–¥
semophore rw = 1;//è¯»è¿›ç¨‹å’Œå†™è¿›ç¨‹äº’æ–¥
semophore w = 1;//ä¼˜å…ˆå†™è¿›ç¨‹

writer(){
 while(1){
  P(w);
  P(rw);
  writing;
  V(rw);
  V(w);
 }
}

reader(){
 while(1){
  P(w);
  P(mutex);
  if(count == 0) P(rw);//ç¬¬ä¸€ä¸ªè¯»è¿›ç¨‹åŠ é”
  count++;
  V(mutex);
  V(w);
  reading;
  P(mutex);
  count--;
  if(count == 0)V(rw);//æœ€åä¸€ä¸ªè¯»è¿›ç¨‹è§£é”
  V(mutex);
 }
}
```

## å“²å­¦å®¶è¿›é¤é—®é¢˜

åªæœ‰ä¸€ç±»è¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹éœ€è¦åŒæ—¶æ‹¥æœ‰å¤šç§èµ„æºæ‰èƒ½è¿è¡Œ

```cpp
semaphore chopsticks[5] = {1,1,1,1,1};//ä¸‹æ ‡ä¸ºiçš„ç­·å­ä»£è¡¨ç¬¬iä½å“²å­¦å®¶å³æ‰‹è¾¹çš„ç­·å­

//æ–¹æ³•ä¸€ï¼šå½“ä¸€ä¸ªå“²å­¦å®¶å·¦å³ç­·å­éƒ½å¯ç”¨æ—¶ï¼Œä¸€èµ·æ‹¿èµ·å·¦å³ä¸¤åªç­·å­
semaphore mutex = 1;
pi(int i){
 while(1){
  P(mutex);
  P(chopsticks[i]);
  P(chopsticks[((i-1)+5)%5]);//å·¦æ‰‹çš„ç­·å­
  V(mutex);
  eat;
  V(chopsticks[i]);
  V(chopsticks[((i-1)+5)%5]);
  think;
 }
}

//æ–¹æ³•äºŒï¼šè‡³å¤šå…è®¸å››ä¸ªå“²å­¦å®¶åŒæ—¶ç”¨é¤
semaphore num = 4;
pi(int i){
 while(1){
  P(num);
  P(chopsticks[i]);
  P(chopsticks[((i-1)+5)%5]);
  eat;
  V(chopsticks[i]);
  V(chopsticks[((i-1)+5)%5]);
  V(num);
  think;
 }
}

//æ–¹æ³•ä¸‰ï¼šå¯¹å“²å­¦å®¶ç¼–å·ï¼Œå¥‡æ•°å·çš„å…ˆæ‹¿å·¦è¾¹ç­·å­ï¼Œå¶æ•°å·çš„æ­£å¥½ç›¸å
pi(int i){
 while(1){
  if(i%2==1){
   P(chopsticks[((i-1)+5)%5]);
   P(chopsticks[i]);
   eat;
   V(chopsticks[((i-1)+5)%5]);
   V(chopsticks[i]);
   think;
  }else{
   P(chopsticks[i]);  
   P(chopsticks[((i-1)+5)%5]);
   eat;
   V(chopsticks[i]);
   V(chopsticks[((i-1)+5)%5]);
   think;
  }
 }
}
```

## å•çº¯çš„åŒæ­¥é—®é¢˜

å‰é©±åç»§å›¾

![](https://img.mileomni.com/1731243128124.png)

```cpp
semaphore s12=s13=s24=s25=s46=s56=s36

S1(){
 ...;
 V(s12);
 V(s13);
}

S2(){
 P(s12);
 ...;
 V(s24);
 V(s25);
}

S3(){
 P(s13);
 ...;
 V(s36);
}

S4(){
 P(s24);
 ...;
 V(s46);
}

S5(){
 P(s25);
 ...;
 V(s56);
}

S6(){
 P(s46);
 P(s56);
 P(s36);
 ...;
}

```
