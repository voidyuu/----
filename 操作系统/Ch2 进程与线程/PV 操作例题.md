---
tags:
  - computerscience
chapter: Ch2 è¿›ç¨‹ä¸çº¿ç¨‹
subject: "[[æ“ä½œç³»ç»Ÿ]]"
category: "[[ğŸ“–Notes]]"
aliases:
---

## ç‰¹æ€§

- [[ç¼“å†²åŒº]]æ˜¯ä¸´ç•ŒåŒºï¼Œéœ€è¦ç”¨ mutex å¤¹èµ·æ¥ã€‚

## 1. ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜

### ä¾‹é¢˜

æ¡Œå­ä¸Šæœ‰ä¸€ä¸ªç›˜å­ï¼Œæ¯æ¬¡åªèƒ½å‘å…¶ä¸­æ”¾å…¥ä¸€ä¸ªæ°´æœã€‚çˆ¸çˆ¸ä¸“å‘ç›˜å­ä¸­æ”¾è‹¹æœï¼Œå¦ˆå¦ˆä¸“å‘ç›˜å­ä¸­æ”¾æ©˜å­ï¼Œå„¿å­ä¸“ç­‰åƒç›˜å­ä¸­çš„æ©˜å­ï¼Œå¥³å„¿ä¸“ç­‰åƒç›˜å­ä¸­çš„è‹¹æœã€‚åªæœ‰ç›˜å­ä¸ºç©ºæ—¶ï¼Œçˆ¸çˆ¸æˆ–å¦ˆå¦ˆæ‰å¯å‘ç›˜å­ä¸­æ”¾ä¸€ä¸ªæ°´æœ; ä»…å½“ç›˜å­ä¸­æœ‰è‡ªå·±éœ€è¦çš„æ°´æœæ—¶ï¼Œå„¿å­æˆ–å¥³å„¿å¯ä»¥ä»ç›˜å­ä¸­å–å‡ºã€‚

```cpp
semaphore plate = 1;
semaphore apple = 0;
semaphore orange = 0;

dad(){
 while(1){
  prepare an apple;
  P(plate);
  put the apple to the plate;
  V(apple);
 }
}

mom(){
 while(1){
  prepare an orange;
  P(plate);
  put the orange to the plate;
  V(orange);
 }
}

son(){
 while(1){
  P(apple);
  take the apple from the plate;
  V(plate);
  eat the apple;
 }
}

daughter(){
 while(1){
  P(orange);
  take the orange from the plate;
  V(plate);
  eat the orange;
 }
}

```

### 2009 å¹´çœŸé¢˜

ä¸‰ä¸ªè¿›ç¨‹ P 1ã€P 2ã€P 3 äº’æ–¥ä½¿ç”¨ä¸€ä¸ªåŒ…å« Nï¼ˆN>0ï¼‰ä¸ªå•å…ƒçš„ç¼“å†²åŒºã€‚
P 1 æ¯æ¬¡ç”¨ produce () ç”Ÿæˆä¸€ä¸ªæ­£æ•´æ•°å¹¶ç”¨ put () é€å…¥ç¼“å†²åŒºæŸä¸€ç©ºå•å…ƒä¸­ï¼›
P 2 æ¯æ¬¡ç”¨ getodd () ä»è¯¥ç¼“å†²åŒºä¸­å–å‡ºä¸€ä¸ªå¥‡æ•°å¹¶ç”¨ countodd () ç»Ÿè®¡å¥‡æ•°ä¸ªæ•°ï¼›
P 3 æ¯æ¬¡ç”¨ geteven () ä»è¯¥ç¼“å†²åŒºä¸­å–å‡ºä¸€ä¸ªå¶æ•°å¹¶ç”¨ counteven () ç»Ÿè®¡å¶æ•°ä¸ªæ•°ã€‚
è¯·ç”¨ä¿¡å·é‡æœºåˆ¶å®ç°è¿™ä¸‰ä¸ªè¿›ç¨‹çš„[[åŒæ­¥ä¸äº’æ–¥]]æ´»åŠ¨ï¼Œå¹¶è¯´æ˜æ‰€å®šä¹‰çš„ä¿¡å·é‡çš„å«ä¹‰ã€‚è¦æ±‚ç”¨ä¼ªä»£ç æè¿°ã€‚

```cpp
semaphore even = 0;
semaphore odd = 0;
semaphore empty = N;
semaphore mutex = 1;

p1(){
 while(1){
  x=produce();
  P(empty);
  P(mutex);
  if(x%2==0) V(even);
  else V(odd);
  put();
  V(mutex);
 }
}

p2(){
 while(1){
  P(odd);
  P(mutex);
  getodd();
  V(mutex);
  V(empty);
  countodd();
 }
}

p3(){
 while(1){
  P(even);
  P(mutex);
  geteven();
  V(mutex);
  V(empty);
  counteven();
 }
}
```

### 2014 å¹´çœŸé¢˜

ç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªèƒ½å®¹çº³ 1000 ä»¶äº§å“çš„ç¯å½¢ç¼“å†²åŒºï¼Œåˆå§‹ä¸ºç©ºã€‚ç”Ÿäº§è€…åœ¨ç¼“å†²åŒºæœªæ»¡æ—¶æ”¾å…¥äº§å“ï¼Œå¦åˆ™ç­‰å¾…ï¼›æ¶ˆè´¹è€…åœ¨ç¼“å†²åŒºæœªç©ºæ—¶å–å‡ºäº§å“ï¼Œä¸”ä¸€ä¸ªæ¶ˆè´¹è€…å¿…é¡»è¿ç»­å–å‡º 10 ä»¶äº§å“åï¼Œå…¶ä»–æ¶ˆè´¹è€…æ‰èƒ½å¼€å§‹å–äº§å“ã€‚

```cpp
semaphore mutex1 = 1;//ç”Ÿäº§è€…çš„äº’æ–¥ä¿¡å·é‡
semaphore mutex2 = 1;//æ¶ˆè´¹è€…çš„äº’æ–¥ä¿¡å·é‡
semaphore empty = 1000;
semaphore full = 0;

producer(){
 while(1){
  produce sth;
  P(empty);
  P(mutex1);
  put product to buffer area;
  V(mutex1);
  V(full);
 }
}

consumer(){
 while(1){
  P(mutex2);
  for(int i=0;i<10;i++){
   P(full);
   take a product from buffer area;
     V(empty);
  }
  V(mutex2);
  consume;
 }
}

```

## 2. ç†å‘å¸ˆé—®é¢˜

### 2011 å¹´çœŸé¢˜

æŸé“¶è¡Œæä¾› 1 ä¸ªæœåŠ¡çª—å£å’Œ 10 ä¸ªä¾›é¡¾å®¢ç­‰å¾…çš„åº§ä½ã€‚é¡¾å®¢åˆ°è¾¾é“¶è¡Œæ—¶ï¼Œè‹¥æœ‰ç©ºåº§ä½ï¼Œåˆ™åˆ°å–å·æœºä¸Šé¢†å–ä¸€ä¸ªå·ï¼Œç­‰å¾…å«å·ã€‚å–å·æœºæ¯æ¬¡ä»…å…è®¸ä¸€ä½é¡¾å®¢ä½¿ç”¨ã€‚å½“è¥ä¸šå‘˜ç©ºé—²æ—¶ï¼Œé€šè¿‡å«å·é€‰å–ä¸€ä½é¡¾å®¢ï¼Œå¹¶ä¸ºå…¶æœåŠ¡ã€‚

``` cpp
semaphore empty = 10;
semaphore full = 0;
semaphore service = 0;
semaphore mutex = 1;

process customer(){
 P(empty);//ç­‰å¾…ç©ºä½
 P(mutex);
 ä»å–å·æœºè·å¾—ä¸€ä¸ªå·ç ;
 V(mutex);
 V(full);//é€šçŸ¥è¥ä¸šå‘˜æœ‰æ–°é¡¾å®¢
 P(service);//ç­‰å¾…å«å·
 V(empty);//å«åˆ°å·åç§»åŠ¨åˆ°æœåŠ¡çª—å£ï¼Œç©ºå‡ºå½“å‰ä½ç½®
 è·å¾—æœåŠ¡;
}
 process è¥ä¸šå‘˜
{
 while (TRUE)
 {
  P(full);
  V(service);//å«å·
  ä¸ºé¡¾å®¢æœåŠ¡;
 }
}
```

```cpp

```

## 3. è¯»è€…å†™è€…é—®é¢˜

## 4. å“²å­¦å®¶è¿›é¤é—®é¢˜

### 2019 å¹´çœŸé¢˜

æœ‰nï¼ˆnâ‰¥3ï¼‰ä½å“²å­¦å®¶å›´ååœ¨ä¸€å¼ åœ†æ¡Œè¾¹ï¼Œæ¯ä½å“²å­¦å®¶äº¤æ›¿åœ°å°±é¤å’Œæ€è€ƒã€‚åœ¨åœ†æ¡Œä¸­å¿ƒæœ‰ mï¼ˆmâ‰¥1ï¼‰ä¸ªç¢—ï¼Œæ¯ä¸¤ä½å“²å­¦å®¶ä¹‹é—´æœ‰ä¸€æ ¹ç­·å­ã€‚æ¯ä½å“²å­¦å®¶å¿…é¡»å–åˆ°ä¸€ä¸ªç¢—å’Œä¸¤ä¾§çš„ç­·å­åï¼Œæ‰èƒ½å°±é¤ï¼Œè¿›é¤å®Œæ¯•ï¼Œå°†ç¢—å’Œç­·å­æ”¾å›åŸä½ï¼Œå¹¶ç»§ç»­æ€è€ƒã€‚ä¸ºä½¿å°½å¯èƒ½å¤šçš„å“²å­¦å®¶åŒæ—¶å°±é¤ï¼Œä¸”é˜²æ­¢å‡ºç°æ­»é”ç°è±¡ã€‚

```cpp
semaphore chopsticks[n];//ä¸‹æ ‡ä¸ºiçš„ç­·å­ä¸ºç¬¬iä½å“²å­¦å®¶å·¦æ‰‹è¾¹çš„ç­·å­
semaphore bowl = m;
semaphore limit = min(m,n-1);//ä¿è¯ç­·å­å’Œç¢—éƒ½å……è¶³

for(int i=0;i<n;i++){
 chopsticks[i]=1;
}

thinker_i(int i){
 P(limit);
 P(chopsticks[i]);
 P(chopsticks[(i+1)%5]);
 åƒé¥­;
 V(chopsticks[(i+1)%5]);
 V(chopsticks[i]);
 V(limit);
 æ€è€ƒ;
}
```

## 5. å•çº¯çš„åŒæ­¥é—®é¢˜

### 2013 ç»Ÿè€ƒçœŸé¢˜

æŸåšç‰©é¦†æœ€å¤šå¯å®¹çº³ 500 äººåŒæ—¶å‚è§‚ï¼Œæœ‰ä¸€ä¸ªå‡ºå…¥å£ï¼Œè¯¥å‡ºå…¥å£ä¸€æ¬¡ä»…å…è®¸ä¸€ä¸ªäººé€šè¿‡ã€‚

```cpp
semaphore mutex = 1;
semaphore room = 500;
visitor()  {
 P(room);
 P(mutex);
 è¿›é—¨;  
 V(mutex);
 å‚è§‚;  
 P(mutex);
 å‡ºé—¨; 
 V(mutex);
 V(room);
}  
```

### 2015 å¹´çœŸé¢˜

æœ‰Aã€Bä¸¤äººé€šè¿‡ä¿¡ç®±è¿›è¡Œè¾©è®ºï¼Œæ¯ä¸ªäººéƒ½ä»è‡ªå£çš„ä¿¡ç®±ä¸­å–å¾—å¯¹æ–¹çš„é—®é¢˜ï¼Œå°†ç­”æ¡ˆå’Œå‘å¯¹æ–¹æå‡ºçš„æ–°é—®é¢˜ç»„æˆä¸€ä¸ªé‚®ä»¶æ”¾äººå¯¹æ–¹çš„ä¿¡ç®±ä¸­ã€‚å‡è®¾Açš„ä¿¡ç®±æœ€å¤šæ”¾Mä¸ªé‚®ä»¶ï¼ŒBçš„ä¿¡ç®±æœ€å¤šæ”¾ Nä¸ªé‚®ä»¶ã€‚åˆå§‹æ—¶Açš„ä¿¡ç®±ä¸­æœ‰xä¸ªé‚®ä»¶ï¼ŒB çš„ä¿¡ç®±ä¸­æœ‰ y ä¸ªé‚®ä»¶ã€‚è¾©è®ºè€…æ¯å–å‡ºä¸€ä¸ªé‚®ä»¶ï¼Œé‚®ä»¶æ•°å‡ä¸€ã€‚

```cpp
semaphore fulla = x;
semaphore fullb = y;
semaphore emptya = M-x;
semaphore emptyb = N-y;
semaphore mutexa = 1;
semaphore mutexb = 1;
A(){
 while(1){
  P(fulla);
  P(mutexa);
  ä»Açš„ä¿¡ç®±å–å‡ºä¸€ä¸ªé‚®ä»¶;
  V(mutexa);
  V(emptya);
  å›ç­”é—®é¢˜å¹¶æå‡ºä¸€ä¸ªæ–°é—®é¢˜;
  P(emptyb);
  P(mutexa);
  å°†æ–°é‚®ä»¶æ”¾å…¥Bçš„é‚®ç®±;
  V(mutexa);
  V(fullb);
 }
}

B(){
 while(1){
  P(fullb);
  P(mutexb);
  ä»Açš„ä¿¡ç®±å–å‡ºä¸€ä¸ªé‚®ä»¶;
  V(mutexb);
  V(emptyb);
  å›ç­”é—®é¢˜å¹¶æå‡ºä¸€ä¸ªæ–°é—®é¢˜;
  P(emptya);
  P(mutexb);
  å°†æ–°é‚®ä»¶æ”¾å…¥Bçš„é‚®ç®±;
  V(mutexb);
  V(fulla);
 }
}
```

### 2017 å¹´çœŸé¢˜

æŸè¿›ç¨‹ä¸­æœ‰ 3 ä¸ªå¹¶å‘æ‰§è¡Œçš„çº¿ç¨‹ thread 1, thread 2 å’Œ thread 3ã€‚

```cpp
//å¤æ•°çš„ç»“æ„ç±»å‹å®šä¹‰
typedef struct{
 float a;
 float b;
}cnum;

cnum x,y,z;//å…¨å±€å˜é‡

//è®¡ç®—ä¸¤ä¸ªå¤æ•°ä¹‹å’Œ
cnum add(cnum p,cnum q){
 cnum s;
 s.a = p.a+q.a;
 s.b = p.b+q.b;
 return s;
}
```

```cpp
semaphore mutex_y1 = 1;//çº¿ç¨‹1å’Œ3å¯¹yçš„äº’æ–¥
semaphore mutex_y2 = 1;//çº¿ç¨‹2å’Œ3å¯¹yçš„äº’æ–¥
semaphore mutex_z = 1;//çº¿ç¨‹2å’Œ3å¯¹zçš„äº’æ–¥

thread1(){
 cnum w;
 P(mutex_y1);
 w = add(x,y);
 V(mutex_y1);
 ...
}

thread2(){
 cnum w;
 P(mutex_y2);
 P(mutex_z);
 w = add(y,z);
 P(mutex_z);
 P(mutex_y2);
}

thread3(){
 cnum w;
 w.a = 1;
 w.b = 1;
 P(mutex_z);
 z = add(z,w);
 V(mutex_z);
 
 P(mutex_y1);
 P(mutex_y2);
 y = add(y,w);
 V(mutex_y2);
 V(mutex_y1);

}
```

### 2020 å¹´çœŸé¢˜

ç°æœ‰ 5 ä¸ªæ“ä½œ Aã€Bã€Cã€D å’Œ Eï¼Œæ“ä½œ C å¿…é¡»åœ¨ A å’Œ B å®Œæˆåæ‰§è¡Œï¼Œæ“ä½œ E å¿…é¡»åœ¨ C å’Œ D å®Œæˆåæ‰§è¡Œã€‚

```cpp
semaphore a = 0,b = 0,c = 0,d = 0;
A(){
 ...;
 V(a);
}

B(){
 ...;
 V(b); 
}

C(){
 P(a);
 P(b);
 ...;
 V(c);
}

D(){
 ...;
 V(d);
}

E(){
 P(c);
 P(d);
 ...;
}
```

### 2022 å¹´çœŸé¢˜

æŸè¿›ç¨‹çš„ä¸¤ä¸ªçº¿ç¨‹ T 1 å’Œ T 2 å¹¶å‘æ‰§è¡Œ Aã€Bã€Cã€Dã€E å’Œ F å…± 6 ä¸ªæ“ä½œï¼Œå…¶ä¸­ T 1 æ‰§è¡Œ Aã€E å’Œ Fï¼ŒT 2 æ‰§è¡Œ Bã€C å’Œ Dã€‚ä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºæ‰€æ»¡è¶³çš„çº¦æŸï¼šC åœ¨ A å’Œ B å®Œæˆåæ‰§è¡Œï¼ŒD å’Œ E åœ¨ C å®Œæˆåæ‰§è¡Œï¼ŒF åœ¨ E å®Œæˆåæ‰§è¡Œã€‚

```cpp
semaphore a = b = c = d = e = f = 0;

T1(){
 A;
 Signal(a);
 Wait(c);
 E;
 F;
}

T2(){
 B;
 Wait(a);
 C;
 Signal(c);
 D;
}
```
